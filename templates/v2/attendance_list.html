{% extends "v2/base2.html" %}

{% block content %}
<h1>Attendance List</h1>

<div class="mb-3">
    <label>Select Date</label>
    <input type="date" id="date-picker" class="form-control" />
</div>

<table class="table table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Name</th>
            <th>Roll</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody id="attendance-body"></tbody>
</table>

<script>
    const dateInput = document.getElementById("date-picker");
    const body = document.getElementById("attendance-body");

    // set today by default
    const today = new Date().toISOString().slice(0, 10);
    dateInput.value = today;

    async function loadAttendance(date) {
        const res = await fetch(`/api/v2/attendance/?date=${date}`);
        const data = await res.json();

        body.innerHTML = "";

        if (data.length === 0) {
            body.innerHTML = `
            <tr>
                <td colspan="3" class="text-center text-muted">
                    No attendance recorded
                </td>
            </tr>
        `;
            return;
        }

        data.forEach(a => {
            body.innerHTML += `
            <tr>
                <td>${a.student_name}</td>
                <td>${a.student_roll}</td>
                <td class="${a.present ? 'text-success' : 'text-danger'}">
                    ${a.present ? 'Present' : 'Absent'}
                </td>
            </tr>
        `;
        });
    }

    // initial load
    loadAttendance(today);

    // reload on date change
    dateInput.addEventListener("change", () => {
        loadAttendance(dateInput.value);
    });
</script>

{% endblock %}