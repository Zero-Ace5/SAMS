{% extends "v2/base2.html" %}
{% block content %}

<h1>Edit Student</h1>

<form id="edit-form">
    <input type="hidden" id="csrf-token" value="{{ csrf_token }}">

    <div class="mb-3">
        <label>Name</label>
        <input class="form-control" id="name">
    </div>

    <div class="mb-3">
        <label>Roll No</label>
        <input class="form-control" id="roll_no">
    </div>

    <div class="mb-3">
        <label>Class</label>
        <input class="form-control" id="s_class">
    </div>

    <div class="mb-3">
        <label>Email</label>
        <input class="form-control" id="email">
    </div>

    <button class="btn btn-primary">Save</button>
</form>

<script>
    const studentId = window.location.pathname.split("/")[3];
    const csrfToken = document.getElementById("csrf-token").value;

    async function loadStudent() {
        const res = await fetch(`/api/v2/students/${studentId}/`);
        const s = await res.json();

        document.getElementById("name").value = s.name;
        document.getElementById("roll_no").value = s.roll_no;
        document.getElementById("s_class").value = s.s_class;
        document.getElementById("email").value = s.email;
    }


    document.getElementById("edit-form").addEventListener("submit", async (e) => {
        e.preventDefault();

        await fetch(`/api/v2/students/${studentId}/`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": csrfToken
            },
            body: JSON.stringify({
                name: document.getElementById("name").value,
                roll_no: document.getElementById("roll_no").value,
                s_class: document.getElementById("s_class").value,
                email: document.getElementById("email").value
            })

        });

        window.location.href = "/v2/students/";
    });

    loadStudent();
</script>


{% endblock %}